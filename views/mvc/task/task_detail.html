{% extends "./../template/base.html" %}

{% block main %}
<link href="//cdn.bootcss.com/Ladda/1.0.0/ladda-themeless.min.css" rel="stylesheet">
<style>
    img {
        cursor: zoom-in;
    }
</style>
<div class="main">
    <table class="table">
        <tr>
            <td class="col-md-3">任务类型</td>
            <td class="col-md-9">{{data.type}}</td>
        </tr>
        <tr>
            <td>发布者</td>
            <td>{{data.name}}</td>
        </tr>
        <tr>
            <td>任务标题</td>
            <td>{{data.title}}</td>
        </tr>
        <tr>
            <td>联系方式</td>
            <td>{{data.tel}}</td>
        </tr>
        <tr>
            <td>截止日期</td>
            <td>{{data.deadline}}</td>
        </tr>
        <tr>
            <td>任务报酬</td>
            <td>{{data.reward}}元</td>
        </tr>
    </table>
    <div class="input-group form-control-static">
        <div class="input-group-btn">
            <label class="btn btn-default disabled">任务详情</label>
        </div>
        <textarea class="form-control" rows="5" id="detail" name="detail"
                  placeholder="请详细说明任务详情，比如地点时间，不然接任务人就一脸懵逼了~" readonly>{{data.detail}}</textarea>
    </div>
    <div class="input-group form-control-static">
    </div>
    <div class="input-group form-control-static">
        <div class="input-group-btn">
            <label class="btn btn-default disabled">补充图片</label>
        </div>
        <img src="{{ data.filename }}" class="thumbnail" width="30%" height="60%" alt="无图片说明">
    </div>
    {% if where === 'unfinished' %}
        <div class="container text-center">
            <div>
                <button id="done" type="button" name="{{ data.id }}" class="btn btn-primary ladda-button"
                        style="width: 30%;">
                    <span class="ladda-label">完成</span>
                </button>
                <button id="abandon" type="button" name="{{ data.id }}" class="btn btn-primary ladda-button"
                        style="width: 30%;margin-left: 10%;">
                    <span class="ladda-label">放弃</span>
                </button>
            </div>
        </div>
    {% elif where === 'published' %}
        {% if data.state === 'released_not_claimed' or data.state === 'completing' %}
            <button id="off" name="{{ data.id }}" type="button" class="btn btn-primary ladda-button submit"
                    data-style="expand-right">
                <span class="ladda-label">下架</span>
            </button>
        {% elif data.state === 'completed' %}
            <button id="paid" name="{{ data.id }}" type="button" class="btn btn-primary ladda-button submit"
                    data-style="expand-right">
                <span class="ladda-label">确认支付</span>
            </button>
        {% endif %}
    {% elif data.type === '会员共享' %}

    {% else %}
        <button id="order" name="{{ data.id }}" type="button" class="btn btn-primary ladda-button submit"
                data-style="expand-right">
            <span class="ladda-label">接单</span>
        </button>
    {% endif %}
</div>
<input type="hidden" value="{{ where }}">
<div class="modal fade" id="enlargeImageModal" tabindex="-1" role="dialog" aria-labelledby="enlargeImageModal"
     aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <img src="" class="enlargeImageModalSource" style="width: 100%;">
            </div>
        </div>
    </div>
</div>
<script src="//cdn.bootcss.com/Ladda/1.0.0/spin.min.js" defer></script>
<script src="//cdn.bootcss.com/Ladda/1.0.0/ladda.min.js" defer></script>
<script src="/static/js/ajax_loading.js"></script>
<script>
  $(() => {
    $('img').click(() => {
      $('.enlargeImageModalSource').attr('src', $('img').attr('src'));
      $('#enlargeImageModal').modal('show');
    });
    $('.ladda-button').click(function () {
      let where = $('input:hidden')[0].value;
      let successCallback = null;
      if (where === 'unfinished') {
        successCallback = () => {
          $('.ladda-button').attr('disabled', true);
        };
      }
      submitAjax($(this), {
        type: 'PUT',
        url: `/api/task/state/${this.id}/${this.name}?where=${where}`
      }, {
        success: '成功',
        fail: '失败'
      }, successCallback);
    });
  });
</script>
{% endblock %}
