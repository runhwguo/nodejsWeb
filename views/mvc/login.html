{% extends "./myBase.html" %}

{% block main %}
<style>
    .custom-form-control {
        width: 70%;
        margin-left: 15%;
    }

    #stdInfo {
        margin-top: 3%;
    }

    #login {
        width: 60%;
        margin-left: 20%;
    }

    #back {
        margin-left: 3%;
        margin-top: 2%;
    }
</style>
<link href="//cdn.bootcss.com/Ladda/1.0.0/ladda-themeless.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/bootstrap-validator/0.5.3/css/bootstrapValidator.css" rel="stylesheet">

<input id="back" type="button" class="btn btn-link" value="< 返回"/>

<form id="stdInfo" action="/api/login" method="post">
    <div class="form-group">
        <input type="text" value="3150803016" class="form-control custom-form-control" id="id" name="id"
               placeholder="学号"/>
    </div>
    <div class="form-group">
        <input type="password" value="jnzx021527" class="form-control custom-form-control" id="password" name="password"
               placeholder="密码"/>
    </div>
    <div class="form-group">
        <input type="text" id="verificationCode" class="form-control"
               style="display: inline-block;margin-left: 15%;width: 40%;"
               name="verificationCode" placeholder="验证码"/>
        <img src="{{verificationCodePictureUrl}}" style="width: 20%;margin-left: 5%;">
    </div>
    <button id="login" type="submit" class="btn btn-primary ladda-button" data-style="expand-right"><span
            class="ladda-label" id="submitBtnWord">登录</span></button>
</form>
<script src="//cdn.bootcss.com/Ladda/1.0.0/spin.min.js" defer></script>
<script src="//cdn.bootcss.com/Ladda/1.0.0/ladda.min.js" defer></script>
<script src="//cdn.bootcss.com/bootstrap-validator/0.5.3/js/bootstrapValidator.js" defer></script>
<script>
  $(() => {
    let form = $("#stdInfo"),
      submitBtnWord = $('#submitBtnWord'),
      back = $('#back');
    form.bootstrapValidator({
      message: 'The form is not valid',
      feedbackIcons: {
        valid: 'glyphicon glyphicon-ok',
        invalid: 'glyphicon glyphicon-remove',
        validating: 'glyphicon glyphicon-refresh'
      },
      fields: {
        id: {
          message: 'The id is not valid',
          validators: {
            notEmpty: {
              message: '请填写学号'
            },
            regexp: {
              regexp: /^[0-9]+$/,
              message: '请填写正确的学号'
            }
          }
        },
        password: {
          message: 'The password is not valid',
          validators: {
            notEmpty: {
              message: '请填写密码'
            }
          }
        },
        verificationCode: {
          message: 'The verificationCode is not valid',
          validators: {
            notEmpty: {
              message: '请填写验证码'
            },
            regexp: {
              regexp: /^[a-zA-Z0-9]{4}$/,
              message: '请填写正确的验证码'
            }
          }
        }
      }
    }).on('success.form.bv', e => {
      e.preventDefault();
      let loading = Ladda.create($('#login').get(0));
      loading.start();
      $.ajax({
        type: form.attr('method'),
        url: form.attr('action'),
        data: JSON.parse('{"' + decodeURIComponent(form.serialize()).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g, '":"') + '"}'),
        success: (data) => {
          if (data.result) {
            submitBtnWord.text('成功');
            setTimeout(() => {
              submitBtnWord.text('登录');
              loading.stop();
              window.location.href = '/userInfo';
            }, 500);
          }
        },
        error: (xhr) => {
          submitBtnWord.text('失败');
          setTimeout(() => {
            submitBtnWord.text('登录');
            loading.stop();
          }, 500);
        }
      });
    });
    back.click(() => {
      window.history.back();
    });
  });
</script>

{% endblock %}
