{% extends "./myBase.html" %}

{% block main %}
<script>
  $(() => {
    let home = $('#homeTab');
    home.attr('href', 'javascript:void(0)');

    if ($(document).scrollTop() >= $(document).height() - $(window).height()) {
      console.log("滚动条已经到达底部为" + $(document).scrollTop());
    }
  });
</script>

<div id="myCarousel" class="carousel slide" data-ride="carousel">
    <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
        <li data-target="#myCarousel" data-slide-to="3"></li>
        <li data-target="#myCarousel" data-slide-to="4"></li>
    </ol>

    <div class="carousel-inner" role="listbox">
        <div class="item active">
            <img src="/static/images/cat1.jpeg" alt="cat1">
        </div>

        <div class="item">
            <img src="/static/images/cat2.jpeg" alt="cat2">
        </div>

        <div class="item">
            <img src="/static/images/cat3.jpeg" alt="cat3">
        </div>

        <div class="item">
            <img src="/static/images/cat4.jpeg" alt="cat4">
        </div>

        <div class="item">
            <img src="/static/images/cat5.jpeg" alt="cat5">
        </div>
    </div>

    <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
</div>

<div id="main">
    <div class="col-xs-4">
        <ul>
            <li>
                <span class="glyphicon glyphicon-earphone" aria-hidden="true"></span>
                <span class="block">代课</span>
            </li>
            <li>
                <span class="glyphicon glyphicon-plane" aria-hidden="true"></span>
                <span class="block">顺风车</span>
            </li>
        </ul>
    </div>

    <div class="col-xs-4">
        <ul>
            <li>
                <span class="glyphicon glyphicon-send"></span>
                <span class="block">代取</span>
            </li>
            <li>
                <span class="glyphicon glyphicon-user"></span>
                <span class="block">会员共享</span>
            </li>
        </ul>
    </div>

    <div class="col-xs-4">
        <ul>
            <li>
                <span class="glyphicon glyphicon-flash"></span>
                <span class="block">借东西</span>
            </li>
            <li>
                <span class="glyphicon glyphicon-flash"></span>
                <span class="block">代做</span>
            </li>
        </ul>
    </div>


    <div class="input-group">
        <input type="text" class="form-control" placeholder="搜索任务：请输入关键字">
        <span class="input-group-btn"><button class="btn btn-default" type="button">确定</button></span>
    </div>
    <div id="vm">
        <p v-if="loading">Loading...</p>
        <ul class="list-group">
            <li v-for="task in tasks" class="list-group-item">
                <span class="task-info">[${task.type}]&nbsp;${task.detail}</span>
                <span class="task-reward">[悬赏]&nbsp;${task.reward}</span>
                <input type="button" class="btn btn-primary btn-xs take-task" value="接单"/>
                <input type="button" class="btn btn-default btn-xs top-task" value="置顶"/>
            </li>
        </ul>
    </div>

</div>

<style>
    .take-task {
        top: 5px;
    }

    .top-task {
        top: 30px;
    }

    .task-reward {
        position: absolute;
        left: 10px;
        top: 30px;
    }

    .task-info {
        position: absolute;
        left: 10px;
        top: 5px;
    }

    #myCarousel {
        height: 201px
    }

    .list-group {
        margin-top: 10px;
    }

    .list-group .list-group-item {
        height: 70px;
        margin-top: 10px;
    }

    .list-group .list-group-item input {
        position: absolute;
        right: 10px;
        width: 80px;
        border-radius: 9px;
    }

    #main {
        margin-left: 20px;
        margin-right: 20px;
    }
</style>
<script src="/static/libs/vue.js"></script>
<script src="/static/libs/vue-resource.js"></script>
<script>
  function showError(resp) {
    resp.json().then(result => console.log('Error: ' + result.message));
  }
  let vm = new Vue({
    delimiters: ['${', '}'],
    el: '#vm',
    data: {
      tasks: [
        {
          type: '1',
          detail: '123',
          reward: 123
        }
      ]
    },
    created: function () { // VM初始化成功后的回调函数
      this
        .$resource('/api/admin/get/pages')
        .get()
        .then(resp => {
          resp
            .json()
            .then(result => {
              vm.count = result.result;
              vm.get();
            });
        });
    },
    methods: {
      get: () => {
        vm.loading = true;
        vm.$resource('/api/admin/get/page/' + vm.page).get()
          .then(resp => {
            vm.loading = false;
            resp.json().then(result => vm.items = result.result);
          }, resp => {
            vm.loading = false;
            showError(resp);
          });
      },
      remove: item => {
        vm.$resource('/api/admin/remove/type/' + item.type + '/id/' + item.id).delete()
          .then(resp => {
            resp.json().then(result => {
              if (result.result) {
                let index = -1;
                for (let i = 0; i < vm.items.length; i++) {
                  if (vm.items[i].id === item.id) {
                    index = i;
                    break;
                  }
                }
                if (index != -1) {
                  vm.items.splice(index, 1);
                  vm.count--;
                }
              } else {
                showError(resp);
              }
            });
          }, showError);
      }
    }
  })
</script>
{% endblock %}
